<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Graph â€¢ Notatki</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand"><a href="/" style="color:inherit;text-decoration:none;">ğŸ“ Notatki</a> â€¢ Graph</div>

    <div class="actions">
      <button id="fitBtn">Dopasuj</button>
      <button id="clusterToggleBtn" class="primary">Klastry: OFF</button>
      <button id="freezeBtn">ZamroÅº: ON</button>
    </div>
  </header>

  <main class="container">
    <div class="note" style="padding: 12px; margin-bottom: 12px;">
      <div style="display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap: wrap;">
        <div style="color: var(--muted); font-size: 13px; line-height:1.4;">
          Graf budowany z relacji <code>[[#id]]</code> â†’ <code>note_links</code>.
          StrzaÅ‚ka: <b>od</b> notatki-linkujÄ…cej <b>do</b> notatki-linkowanej (reply â†’ parent).
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
          <input id="q" type="search" placeholder="Filtruj po tytuleâ€¦" />
          <button id="reloadBtn" class="primary">OdÅ›wieÅ¼</button>
        </div>
      </div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr minmax(320px, 380px); gap: 14px; align-items: start;">
      <div id="graph" class="note" style="height: calc(100vh - 210px); min-height: 520px;"></div>

      <!-- Drawer / panel notatki -->
      <aside id="drawer" class="note" style="position: sticky; top: 78px; height: calc(100vh - 210px); min-height: 520px; overflow: hidden;">
        <div class="note-header" style="grid-template-columns: 1fr auto; gap: 10px;">
          <div>
            <div id="dTitle" style="font-weight:800;">Kliknij notatkÄ™ na grafie</div>
            <div id="dMeta" class="meta" style="display:block; margin-top: 2px;"></div>
          </div>
          <button id="dClose" class="toggle" title="WyczyÅ›Ä‡" aria-label="WyczyÅ›Ä‡">âœ•</button>
        </div>

        <div class="note-body" style="height: calc(100% - 58px); overflow: auto;">
          <div id="dActions" class="buttons" style="margin-bottom: 10px; gap: 10px; flex-wrap: wrap;">
            <button id="dOpen">OtwÃ³rz w aplikacji</button>
            <button id="dReply" class="primary">Odpowiedz</button>
            <button id="dNew">Nowa notatka</button>
          </div>

          <div id="dOwnerActions" class="hidden" style="margin-bottom: 10px;">
            <div class="buttons" style="gap:10px; flex-wrap: wrap;">
              <button id="dToggleEdit">Edytuj</button>
              <button id="dSave" class="primary">Zapisz</button>
              <button id="dDelete" class="danger">UsuÅ„</button>
            </div>

            <label class="pub-switch" style="margin-top: 10px; display:inline-flex;">
              <input id="dIsPublic" type="checkbox" />
              <span class="switch" aria-hidden="true"></span>
              <span class="label">Publiczna</span>
            </label>

            <div id="dStatus" class="status" style="margin-top: 8px;"></div>
          </div>

          <div id="dView" class="preview"></div>

          <textarea id="dEdit" class="content hidden" rows="10" placeholder="TreÅ›Ä‡â€¦"></textarea>
        </div>
      </aside>
    </div>

    <div class="hint" style="max-width: 980px; margin: 10px auto 0;">
      Tip: jeÅ›li graf â€œpÅ‚ywaâ€, kliknij â€œZamroÅº: ONâ€. MoÅ¼esz teÅ¼ przeciÄ…gaÄ‡ notatki myszkÄ…, a potem zamroziÄ‡.
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <script src="/static/graph.js"></script>
</body>
</html>
